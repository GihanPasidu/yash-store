<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="YashStore - Premium handcrafted earrings collection. Find elegant and unique earrings for every occasion. Free shipping on orders over $50.">
    <meta name="keywords" content="earrings, jewelry, handcrafted earrings, gold earrings, silver earrings, fashion accessories">
    <meta name="author" content="CloudNextra Solution">
    
    <!-- Force browser to get latest version -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="YashStore - Exquisite Earrings Collection">
    <meta property="og:description" content="Discover our handcrafted collection that adds sparkle to your style">
    <meta property="og:image" content="images/og-image.jpg">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="YashStore - Exquisite Earrings Collection">
    <meta name="twitter:description" content="Discover our handcrafted collection that adds sparkle to your style">
    
    <title>YashStore - Exquisite Earrings Collection</title>
    
    <!-- Resource hints for faster loading -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Critical CSS inline -->
    <style>
        /* Critical path CSS for faster rendering */
        header {background-color:white; box-shadow:0 2px 10px rgba(0,0,0,0.1); position:sticky; top:0; z-index:1000;}
        header .container {display:flex; justify-content:space-between; align-items:center; padding:15px;}
        .container {width:90%; max-width:1200px; margin:0 auto; padding:0 15px;}
        .logo h1 {color:#e74c3c; font-size:1.8rem; margin:0; letter-spacing:1px; text-transform:uppercase;}
        #cart-count {position:absolute; top:-10px; right:-10px; background-color:#e74c3c; color:white; border-radius:50%; font-size:0.7rem; padding:2px 6px;}
    </style>
    
    <!-- Load critical stylesheets first -->
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Defer non-critical CSS -->
    <link rel="stylesheet" href="css/pages/products.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/pages/product-details.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/pages/cart.css" media="print" onload="this.media='all'">
    
    <!-- Defer non-critical fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    
    <!-- Fallback for browsers that don't support onload -->
    <noscript>
        <link rel="stylesheet" href="css/pages/products.css">
        <link rel="stylesheet" href="css/pages/product-details.css">
        <link rel="stylesheet" href="css/pages/cart.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    </noscript>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/favicon.png">
    
    <!-- Schema.org markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "JewelryStore",
        "name": "YashStore",
        "image": "images/logo.png",
        "description": "Premium handcrafted earrings collection",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "123 Main Street",
            "addressLocality": "City",
            "addressCountry": "Country"
        },
        "priceRange": "$$"
    }
    </script>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <a href="index.html"><h1>YashStore</h1></a>
            </div>
            <div class="cart-icon">
                <a href="cart.html"><i class="fas fa-shopping-cart"></i> <span id="cart-count">0</span></a>
            </div>
        </div>
    </header>

    <div class="page-content">
        <style>
            .hero {
                background-image: url('https://i.pinimg.com/736x/5f/98/13/5f98130c15243a3ffa58b1400ce9d4a9.jpg');
                background-repeat: repeat;
                background-size: 350px;
                position: relative;
            }
            
            .hero::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.75);
                z-index: 1;
                backdrop-filter: blur(1px);
            }
            
            .hero-content {
                position: relative;
                z-index: 2;
            }
        </style>

        <section class="hero">
            <div class="container">
                <div class="hero-content">
                    <h2>Elegant Earrings for Every Occasion</h2>
                    <p>Discover our handcrafted collection that adds sparkle to your style</p>
                    <a href="products.html" class="btn">Shop Collection</a>
                </div>
            </div>
        </section>

        <section class="featured">
            <div class="container">
                <h2 class="section-title">Featured Collection</h2>
                <div id="featured-products" class="products-grid">
                    <!-- Featured products will be dynamically loaded here -->
                    <div class="loading-products">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading featured products...</p>
                    </div>
                </div>
                <div class="center" style="margin-top: 40px;">
                    <a href="products.html" class="btn">View All Products</a>
                </div>
            </div>
        </section>
    </div>

    <footer>
        <div class="container">
            <div class="copyright">
                <p>&copy; 2023 YashStore. All rights reserved. Powered by <a href="https://github.com/GihanPasidu" target="_blank">CloudNextra Solution</a>.</p>
            </div>
        </div>
    </footer>
    
    <!-- Defer JavaScript loading -->
    <script src="js/products-data.js" defer></script>
    <script src="js/main.js" defer></script>
    
    <script>
        // Inline critical JavaScript for faster initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Update cart count immediately 
            const cartCount = document.getElementById('cart-count');
            if (cartCount) {
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                const count = cart.reduce((total, item) => total + item.quantity, 0);
                cartCount.textContent = count.toString();
            }
            
            // Load featured products from product data
            const loadFeaturedProducts = function() {
                const featuredProductsContainer = document.getElementById('featured-products');
                if (!featuredProductsContainer) return;
                
                // Check if window.products is available
                if (!window.products || !Array.isArray(window.products)) {
                    console.warn('Products data not available yet, will retry');
                    setTimeout(loadFeaturedProducts, 300);
                    return;
                }
                
                // Clear loading placeholder
                featuredProductsContainer.innerHTML = '';
                
                // Define featured product IDs - select 4 products for the featured section
                const featuredIds = [1, 2, 3, 13]; // Black Stud, White Flower, Gold Hoop, Pearl Stud
                
                // Filter products to get only the featured ones
                const featuredProducts = window.products.filter(product => featuredIds.includes(product.id));
                
                // Create and append product cards
                featuredProducts.forEach(product => {
                    // Make sure product has a valid name
                    const productName = product.name || 'Earrings';
                    
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    
                    productCard.innerHTML = `
                        <div class="product-image loading">
                            <img src="${product.image}" alt="${productName}" loading="lazy"
                                 onerror="this.src='https://via.placeholder.com/300x300?text=Earrings'; this.classList.add('loaded');">
                            <div class="product-overlay">
                                <button class="add-to-cart" data-id="${product.id}">Add to Cart</button>
                                <button class="view-details" data-id="${product.id}">View Details</button>
                            </div>
                        </div>
                        <div class="product-info">
                            <h3>${productName}</h3>
                            <p class="price">Rs ${product.price.toFixed(2)}</p>
                        </div>
                    `;
                    
                    featuredProductsContainer.appendChild(productCard);
                    
                    // Handle image loading
                    const img = productCard.querySelector('img');
                    img.onload = function() {
                        img.classList.add('loaded');
                        img.parentElement.classList.remove('loading');
                    };
                    
                    if (img.complete) {
                        img.classList.add('loaded');
                        img.parentElement.classList.remove('loading');
                    }
                    
                    // Add event listeners
                    const addToCartBtn = productCard.querySelector('.add-to-cart');
                    if (addToCartBtn) {
                        addToCartBtn.addEventListener('click', function() {
                            const id = parseInt(this.getAttribute('data-id'));
                            if (typeof addToCart === 'function') {
                                addToCart(id);
                            } else {
                                // Fallback if addToCart function is not available
                                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                                const exists = cart.find(item => item.id === id);
                                
                                if (exists) {
                                    exists.quantity += 1;
                                } else {
                                    cart.push({
                                        id: product.id,
                                        name: product.name,
                                        price: product.price,
                                        image: product.image,
                                        quantity: 1
                                    });
                                }
                                
                                localStorage.setItem('cart', JSON.stringify(cart));
                                
                                // Update cart count
                                const cartCount = document.getElementById('cart-count');
                                if (cartCount) {
                                    const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
                                    cartCount.textContent = totalItems.toString();
                                }
                                
                                alert(`${product.name} added to cart!`);
                            }
                        });
                    }
                    
                    const viewDetailsBtn = productCard.querySelector('.view-details');
                    if (viewDetailsBtn) {
                        viewDetailsBtn.addEventListener('click', function() {
                            const id = parseInt(this.getAttribute('data-id'));
                            window.location.href = `product-details.html?id=${id}`;
                        });
                    }
                });
                
                console.log('Featured products loaded successfully');
            };
            
            // Load featured products
            loadFeaturedProducts();
            
            // Fix for Netlify SPA routing
            document.querySelectorAll('a').forEach(link => {
                if (link.href.includes(window.location.origin) && !link.href.includes('#') && !link.getAttribute('target')) {
                    link.addEventListener('click', function(e) {
                        // Clear any errors in the console on navigation
                        console.clear();
                    });
                }
            });
        });
        
        // Add lazy loading for images
        if ('loading' in HTMLImageElement.prototype) {
            // Browser supports native lazy loading
            document.querySelectorAll('img').forEach(img => {
                if (!img.loading) img.loading = 'lazy';
            });
        } else {
            // Fallback lazy loading with Intersection Observer
            const lazyImages = document.querySelectorAll('img:not([loading="eager"])');
            const imageObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        if (img.dataset.src) {
                            img.src = img.dataset.src;
                            img.removeAttribute('data-src');
                        }
                        imageObserver.unobserve(img);
                    }
                });
            });
            lazyImages.forEach(img => imageObserver.observe(img));
        }
    </script>
    
    <script>
        // Register service worker for better cache control
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
